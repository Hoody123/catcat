$(function(){var a=MPWidget.Frame.New();a.Body.append(MPTemplate.Page.Setting());$("body").append(a);a=a.Body;switch(MPData.sub1){case "password":var h=a.find("#oldpassword"),c=a.find("#newpassword1"),k=a.find("#newpassword");a.find(".submit").click(function(){""==h.val()||""==c.val()||""==k.val()?MPMessageBox.New(MPMessageBox.Icons.Warn,"\u8bf7\u5c06\u4fe1\u606f\u8865\u5145\u5b8c\u6574"):c.val()!=k.val()?MPMessageBox.New(MPMessageBox.Icons.Warn,"\u4e24\u6b21\u8f93\u5165\u7684\u65b0\u5bc6\u7801\u4e0d\u4e00\u81f4,\u8bf7\u91cd\u65b0\u8f93\u5165!"):$.post(host+"/ajax/setting-password",{old_password:MPHtmlEncode(h.val()),new_password:MPHtmlEncode(c.val())},function(a){0==a.code?MPMessageBox.New(MPMessageBox.Icons.OK,"\u5bc6\u7801\u4fee\u6539\u6210\u529f"):MPMessageBox.New(MPMessageBox.Icons.Error,a.msg)},"json")});break;default:var l=a.find("#username"),n=a.find("#description"),m,e,f,g;a.find(".upload").click(function(){MPUploadDialog.New("\u4e0a\u4f20\u5934\u50cf\u56fe\u7247").onSuccess=function(a){m=a.hash;var d=MPAvtCutDialog.New(a);d.onSuccess=function(){e=d.offset_x;f=d.offset_y;g=d.size;var b=$(".page-setting .avt"),c=b.find("img"),b=b.width()/g;c.attr("src",imageHost+"/"+a.hash+"_fw658.jpg");c.css({width:Math.round(b*a.width)+"px",height:Math.round(b*a.height)+"px",marginLeft:"-"+Math.round(b*e)+"px",marginTop:"-"+Math.round(b*f)+"px"})}}});a.find(".submit").click(function(){""==l.val()?MPMessageBox.New(MPMessageBox.Icons.Warn,"\u8bf7\u8f93\u5165\u6635\u79f0"):$.post(host+"/ajax/setting-basic",{name:MPHtmlEncode(l.val()),description:MPHtmlEncode(n.val()),avt_hash:m,avt_offset_x:e,avt_offset_y:f,avt_size:g},function(a){0==a.code?MPMessageBox.New(MPMessageBox.Icons.OK,"\u7528\u6237\u4fe1\u606f\u4fee\u6539\u6210\u529f"):MPMessageBox.New(MPMessageBox.Icons.Error,a.msg)},"json")})}});